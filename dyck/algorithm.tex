\begin{algorithm}[H]
    \caption{Na\"{i}ve Generator}
    \begin{algorithmic}
        \Procedure{Split}{$U, D, k$}
            \State{$S \gets U + D$}\\
            \State{$d \sim \left\{\frac{\binom{S}{S-d}\binom{S}{D+d}}{\binom{2S}{2D}}\right\}_d$}\\\\
            \State{$k' \gets k + U - D$}\\
            \State{$p_d \gets
                \frac{{{S}\choose{D-d}}-{{S}\choose{D-d-k}}{{S}\choose{U-d}}
                -{{S}\choose{U-d-k'}}}{{{2S}\choose{2D}}-{{2S}\choose{2D-k}}}$}
            \State{$q_d \gets \frac{\binom{S}{S-d}\binom{S}{D+d}}{\binom{2S}{2D}}$}\\
            \If {$p_d < q_d$}
                \State \Return $d$
            \EndIf
            \State{\textbf{draw} $X \sim\distr{Bern}(p_d/q_d)$}
            \If {$X = 0$}
                \State \Return $d$
            \EndIf
            \Return \func{Split}($U, D, k, k'$)

        \EndProcedure
        \Procedure{Height}{$x$}
            \If {$x\in heights$}
                \State \Return $heights[x]$
            \EndIf
            \State{$l \gets \func{lower-bound}(x)$}
            \State{$r \gets \func{upper-bound}(x)$}
            \State{$h_l \gets \func{Height}(l)$}
            \State{$h_r \gets \func{Height}(r)$}
            \State{$extra \gets (r-l)-(h_r-h_l)$}
            \State{$U\gets (h_r-h_l) + extra/2$}
            \State{$D\gets extra/2$}
            \State{$k\gets 1 + h_l$}
            \State{$d \gets \func{Split}(U,D,k)$}
            \State{$heights[(r+l)/2] \gets h_l + U + d$}
            \State \Return $\func{Height}(x)$
        \EndProcedure
    \end{algorithmic}
    \label{alg:naive}
\end{algorithm}
